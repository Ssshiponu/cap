{% extends "core/dashboard.html" %}

{% block title %}Settings - {{ page.page_name }} | Chat Autopilot{% endblock title %}

{% block content %}
<div class="h-auto p-4 sm:p-6">
    <div class="flex flex-col">
        {% include "core/partials/breadcrumbs.html" with title="Settings" %}
        <div class="flex-1 py-6 space-y-4">
            
            {% include "core/partials/alerts.html" %}
            <div class="text-nowrap py-5 px-6 card">
                <div class="flex justify-between gap-3">
                    <div class="flex flex-col">
                        <div class="flex items-center gap-3">
                            <h3 class="h3">Message replies</h3>
                            <span class="badge py-0.5 text-xs bg-amber-100">{{ page.credits_per_reply }} C/Reply</span>
                        </div>
                        <p class="text-sm text-neutral-500">Pause or Active page replies</p>
                    </div>
                    <form action="{% url "toggle" page.id %}?t=replies" method="POST">
                        {% include "core/partials/toggle.html" with status=page.enabled|lower %}
                    </form>
                </div>
                <hr class="my-4">
                <div class="flex justify-between gap-3">
                    <div class="flex flex-col">
                        <div class="flex items-center gap-3">
                            <h3 class="h3">Comment replies</h3>
                            <span class="badge py-0.5 text-xs bg-amber-100">{{ page.credits_per_comment }} C/Comment</span>
                        </div>
                        <p class="text-sm text-neutral-500">Pause or Active comment replies</p>
                    </div>
                    <form action="{% url "toggle" page.id %}?t=comments" method="POST">
                        {% include "core/partials/toggle.html" with status=page.comment_enabled|lower|default:"false" %}
                    </form>
                </div>
                <hr class="my-4">
                <div class="flex justify-between gap-3">
                    <div class="flex flex-col">
                        <h3 class="h3">Product cards</h3>
                        <p class="text-sm text-neutral-500 text-wrap">Connect woocommerce website to automatically fetch products or add products manually. sent as cards</p>
                    </div>

                    <div class="flex items-center flex-col sm:flex-row-reverse gap-2">
                        <form action="{% url "toggle" page.id %}?t=product" method="POST">
                            {% include "core/partials/toggle.html" with status=page.product_card|lower|default:"false" %}
                        </form>
                        <div class="relative" x-data="{ open: false }">
                            <button @click="open = ! open" class="relative btn p-0.5 px-2.5 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 128 128"><path fill="#7f54b3" d="M116.3 89.1H11.7C5.2 89.1 0 83.9 0 77.4v-40C0 31 5.2 25.8 11.7 25.8h104.7c6.4 0 11.7 5.2 11.7 11.7v40c-.1 6.4-5.3 11.6-11.8 11.6z"/><path fill="#FFF" d="M13.8 76.7s2.8 11.8 8.5 3.9 11.2-20.3 11.2-20.3.4-3.1 2 3.7S44 80 44 80s6.3 7.9 8.9-.4c-1-11 2.8-31 6.7-40.6 1.6-8.5-7.3-6.1-8.1-4.1s-6.3 14.8-6.7 28.2c0 0-4.7-12.8-5.1-17.4-.4-4.7-5.3-5.9-8.1-1.4S20.3 66.2 20.3 66.2l-5.5-28.4s-5.5-7.3-8.7 1.6c0 0 5.7 34.9 7.7 37.3zM87 45.7c-8.5-14.2-21.1-3.4-21.1-3.4s-9.6 11.1-5.3 26.2c6.9 14.9 16.6 8.3 19.2 7.1 2.7-1.3 14.1-14.3 7.2-29.9zm-6.5 12.5c0 5.9-4.9 11.4-8.9 10.2-2.2-1.3-3.6-4.8-3.6-10.8 2-9.7 6.4-11 8.7-10.8 4.3 2.3 4.1 7.4 3.8 11.4zM118.9 45.7c-8.5-14.2-21.1-3.4-21.1-3.4s-9.6 11.1-5.3 26.2c6.9 14.9 16.6 8.3 19.2 7.1 2.6-1.3 14.1-14.3 7.2-29.9zm-6.5 12.5c0 5.9-4.9 11.4-8.9 10.2-2.2-1.3-3.6-4.8-3.6-10.8 2-9.7 6.4-11 8.7-10.8 4.2 2.3 4 7.4 3.8 11.4z"/><path fill="#7f54b3" d="M61.3 89.1l22.3 13.1-4.7-13.1-12.8-3.6z"/></svg>
                                <span class="hidden sm:block">WooCommerce</span>
                                {% if page.woo %}
                                    {% if page.woo.connected %}
                                    <span class="w-4 h-4 p-0.5 absolute -top-1 -right-1 rounded-full bg-green-500 text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-icon lucide-check"><path d="M20 6 9 17l-5-5"/></svg>
                                    </span>
                                    {% elif page.woo.error %}
                                    <span class="w-4 h-4 absolute -top-1 -right-1 rounded-full bg-red-500 text-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-alert-icon lucide-circle-alert"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
                                    </span>
                                    {% endif %}
                                {% endif %}
                            </button>
                            <div x-show="open" @click.outside="open = false" x-transition x-cloak class="absolute z-[10] top-10 -right-4 mt-2 w-72 bg-white border border-neutral-200 rounded-2xl shadow-lg">
                                <div class="absolute -top-2 right-6 border-l border-t rotate-45 w-4 h-4 bg-white border-neutral-200"></div>
                                <form autocomplete="off" action="{% url 'connect_woo' %}" method="post" class="p-3 text-wrap space-y-2">
                                    <div class="text-lg font-medium ml-2">Wordpress</div>
                                    <span class="text-xs font-medium text-black">
                                        woocommerce > settings > advanced > REST API
                                    </span>
                                    <p class="text-sm text-neutral-500">Enter credentials to connect</p>
                                    {% csrf_token %}
                                    <input type="hidden" name="page_id" value="{{ page.id}}">
                                    <div class="space-y-1">
                                        <label for="url" class="text-sm font-medium">Wordpress website URL</label>
                                        <input value="{{ page.woo.store_url }}" type="text" id="url" name="store_url" class="input w-full" placeholder="e.g https://example.com">
                                    </div>

                                    <div class="space-y-1">
                                        <label for="consumer-key" class="text-sm font-medium">Consumer Key</label>
                                        <input value="{{ page.woo.consumer_key }}" type="text"  id="consumer-key" spellcheck="false" name="consumer_key" class="input w-full" style="-webkit-text-security: disc;">
                                    </div>
                                    <div class="space-y-1">
                                        <label for="consumer-secret" class="text-sm font-medium">Consumer Secret</label>
                                        <input value="{{ page.woo.consumer_secret }}" type="text" id="consumer-secret" name="consumer_secret" class="input w-full"  style="-webkit-text-security: disc;">
                                    </div>
                                    <div class="flex items-center justify-between gap-2 mt-4 text-sm">
                                        <a role="button" {% if not page.woo %}disabled{% endif %} href="{% url 'disconnect_woo' %}?page_id={{ page.id}}" class="btn btn-danger btn-sm disabled:opacity-50 disabled:cursor-not-allowed" onclick="return confirm('Are you sure you want to disconnect this page?');">Disconnect</a>
                                        <div class="flex gap-1">
                                            <button type="button" @click="open = false" class="btn btn-sm">Cancel</button>

                                            <button type="submit" class="btn btn-sm btn-primary">Save</button>

                                        </div>
                                    </div>

                                    {% if page.woo.error %}
                                    <div class="mt-2 text-sm text-red-500">
                                        {{ page.woo.error|safe }}
                                    </div>
                                    {% endif %}

                                </form>
                            </div>

                        </div>

                        {% comment %} <div class="relative" x-data="{ open: false }">
                            <button @click="open = ! open" class="btn p-1.5 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-plus-icon lucide-package-plus"><path d="M16 16h6"/><path d="M19 13v6"/><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"/><path d="m7.5 4.27 9 5.15"/><polyline points="3.29 7 12 12 20.71 7"/><line x1="12" x2="12" y1="22" y2="12"/></svg>
                            </button>
                        </div> {% endcomment %}
                        
                    </div>
                    
                </div>

                <hr class="my-4">
                <form action="{% url "update_page" page.id %}?next={{ request.path }}" method="POST">
                    {% csrf_token %}
                    <div x-data="{ open: false, system_prompt: '{{ page.system_prompt|escapejs }}' }" class="flex flex-col items-start justify-between gap-3">
                        <div class="flex w-full items-start justify-between">
                            <div class="flex flex-col">
                                <h3 class="h3">System Prompt</h3>
                                <p class="text-sm text-neutral-500 text-wrap">Customize AI behavior. Describe what your ai should do, what it should not do.</p>
                            </div>
                            <button @click="open = ! open" type="button" class="btn not-sm:p-1.5 btn-sm flex items-center gap-2">
                                <span class="hidden sm:block">Edit</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen-icon lucide-square-pen"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>
                            </button>
                        </div>
                        
                        <div x-show="open" x-collapse class="w-full">
                            <textarea x-model="system_prompt" name="system_prompt" id="system_prompt" rows="8" class="input bg-neutral-50 w-full p-3"></textarea>
                            <div class="flex justify-between gap-2 w-full">
                                <p class="text-neutral-600"><span x-text="{{ settings.CREDITS_PER_REPLY }} + Math.round(countTokens(system_prompt) * {{ settings.CREDITS_PER_TOKEN }})"></span>  Credits/reply</p>
                                <button type="submit" class="btn btn-sm btn-primary">Save</button>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">
                    <div x-data="{ open: false, business_context: '{{ page.business_context|escapejs }}' }" class="flex flex-col items-start justify-between gap-3">
                        <div class="flex w-full items-start justify-between">
                            <div class="flex flex-col">
                                <h3 class="h3">Business Context</h3>
                                <p class="text-sm text-neutral-500 text-wrap">Extra knowledge and data about your business and products</p>
                            </div>
                            <button @click="open = ! open" type="button" class="btn not-sm:p-1.5 btn-sm flex items-center gap-2">
                                <span class="hidden sm:block">Edit</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen-icon lucide-square-pen"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>
                            </button>
                        </div>
                        
                        <div x-show="open" x-collapse class="w-full">
                            <textarea x-model="business_context" name="business_context" id="business_context" rows="8" class="input bg-neutral-50 w-full p-3"></textarea>
                            <div class="flex justify-between gap-2 w-full">
                                <p class="text-neutral-600">It doesn't cost anything</p>
                                <button type="submit" class="btn btn-sm btn-primary">Save</button>
                            </div>
                        </div>
                    </div>
                 </form>


                
            </div>
            <div class="card">
                <div class="flex items-start justify-between gap-3">
                    <div class="flex flex-col">
                        <h3 class="h3">Reconnect page</h3>
                        <p class="text-sm text-neutral-500">Reconnect this page if you have any issues. This will not delete any data</p>
                    </div>
                    <form action="{% url "reconnect_page" page.id %}?next={{ request.path }}" method="POST">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm not-sm:p-2 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-ccw-icon lucide-refresh-ccw"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
                            <span class="hidden sm:block">Reconnect</span>
                        </button>
                    </form>
                </div>
                <hr class="my-4">

                <div class="flex items-start justify-between gap-3">
                    <div class="flex flex-col">
                        <h3 class="h3">Delete & Disconnect</h3>
                        <p class="text-sm text-neutral-500">Delete and Disconnect this page from Chat Autopilot. All its data will be lost</p>

                    </div>
                    <form action="{% url "delete_page" page.id %}" method="POST" onsubmit="return confirm('Are you sure you want to delete this page? This action cannot be undone.'); ">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm not-sm:p-2 btn-danger flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2"><path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            <span class="hidden sm:block">Delete</span>
                        </button>
                    </form>
                </div>
            </div>
            

        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}


{% endblock scripts %}