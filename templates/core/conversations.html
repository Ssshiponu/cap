{% extends "core/dashboard.html" %}

{% block title %}Conversations - {{ page.page_name }} | Chat Autopilot{% endblock title %}

{% block content %}
<div class="h-auto p-4 sm:p-6">
    <div class="flex flex-col">
        {% include "core/partials/breadcrumbs.html" with title="Conversations" %}

        <div class="flex-1 py-6 space-y-4">
            
            {% include "core/partials/alerts.html" %}


            <div class="card p-3 overflow-y-auto">
                <table class="w-full table-auto border-collapse">
                    <thead class="bg-white border-b border-neutral-200 text-left text-sm font-medium text-neutral-700">
                        <tr>
                            <th class="px-4 py-3">#</th>
                            <th class="px-4 py-3">Last Message</th>
                            <th class="px-4 py-3">User ID</th>
                            <th class="px-4 py-3">Messages</th>
                            <th class="px-4 py-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="mt-2">
                        {% for c in conversations %}
                        <tr class="hover:bg-neutral-50">
                            <td class="px-4 py-2.5 text-sm text-neutral-700" x-text="{{ forloop.counter }} + {{ conversations.paginator.per_page }} * ({{ conversations.number }} - 1)"></td>
                            <td class="px-4 py-2.5">
                                <p class="line-clamp-1 text-neutral-600">{{ c.messages.first.content|truncatechars:30 }}</p>
                            </td>
                            <td class="px-4 py-2.5">
                                <a target="_blank" href="https://facebook.com/profile.php?id={{ c.user_id }}" class="link">
                                    {{ c.user_id }}
                                </a>
                            </td>
                            <td class="px-4 py-2.5 text-sm text-neutral-700">{{ c.messages.count|default:0 }}</td>
                            <td class="px-4 py-2.5">
                                <a href="{% url "conversation_action" page_id=page.id conversation_id=c.id %}?next={{ request.path }}&action=delete" class="link text-red-600">Delete</a>
                                {% if c.paused %}
                                <a href="{% url "conversation_action" page_id=page.id conversation_id=c.id %}?next={{ request.path }}&action=resume" class="link text-green-500">Resume</a>
                                {% else %}
                                <a href="{% url "conversation_action" page_id=page.id conversation_id=c.id %}?next={{ request.path }}&action=pause" class="link text-blue-500">Pause</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td class="px-4 text-center col-span-4 py-4 text-sm text-neutral-700" colspan="5">No conversations</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="flex items-center justify-between w-full mt-4">
                    <p class="pl-2 text-sm text-neutral-700">{% if conversations.next_page_number > 1 %}<span class="font-medium">{{ conversations.number }} </span> to <span class="font-medium">{{ conversations.paginator.per_page }}</span> of <span class="font-medium">{{ conversations.paginator.count }}</span>{% else %}<span class="font-medium">{{ conversations.paginator.count }}</span>{% endif %} Conversations</p>
                    <nav>
                        <ul class="flex items-center text-sm leading-tight bg-white border divide-x rounded-lg h-9 text-neutral-500 divide-neutral-200 border-neutral-200">
                            
                            <li class="h-full">
                                <a href="{% if conversations.has_previous %}?page={{ conversations.previous_page_number }}{% else %}#{% endif %}" class="relative inline-flex items-center h-full px-3 ml-0 rounded-l group hover:text-neutral-900">
                                    <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left-icon lucide-chevron-left"><path d="m15 18-6-6 6-6"/></svg></span>
                                </a>
                            </li>

                                
                                <li class="hidden h-full md:block">
                                    <a href="#" class="relative inline-flex items-center h-full px-3 text-neutral-900 group bg-neutral-50">
                                        <span>{{ conversations.number }}</span>
                                        <span class="box-content absolute bottom-0 left-0 w-full h-px -mx-px translate-y-px border-l border-r bg-neutral-900 border-neutral-900"></span>
                                    </a>
                                </li>
                                
                                
                            <li class="h-full">
                                <a href="{% if conversations.has_next %}?page={{ conversations.next_page_number }}{% else %}#{% endif %}" class="relative inline-flex items-center h-full px-3 rounded-r group hover:text-neutral-900">
                                    <span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right-icon lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg></span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            

        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}


{% endblock scripts %}