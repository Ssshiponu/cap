{% extends "base.html" %}
{% load static %}
{% block body %}
{% include "partials/toast.html" %}

<script>
    {% if messages %}
        document.addEventListener('DOMContentLoaded', () => {
            {% for message in messages %}
                toast('{{ message }}', { type: '{{ message.tags }}' });
            {% endfor %}
        })
    {% endif %}
window.addEventListener('offline', () => {
    toast('You are offline', { type: 'error' });
})

window.addEventListener('online', () => {
    toast('Back online', { type: 'success' });
})
</script>

<div x-data="main()" class="h-dvh flex flex-col">
    <header class="bg-white border-b border-neutral-200 z-20">
        <div class="flex items-center justify-between h-full py-3 px-4 mx-auto">


            <div class="flex gap-2 md:gap-3">
                <button class="lg:hidden btn border-none bg-white p-1.5 aspect-square" @click="sidebar = !sidebar;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu-icon lucide-menu"><path d="M4 5h16"/><path d="M4 12h16"/><path d="M4 19h16"/></svg>
                </button>
                {% include "brand.html" %}
            </div>

            <div class="flex gap-3 items-center">
                <nav>
                    <ul class="flex items-center gap-1">

                        <li><a href="#"  class="hidden sm:flex btn-link">
                            <lord-icon
                                src="https://cdn.lordicon.com/biqqsrac.json"
                                trigger="hover"
                                style="width:20px;height:20px">
                            </lord-icon>
                            Get Help</a>
                        </li>
                        <li x-data="{ open: false }" class="relative"><a @click="open = !open" href="#" class="btn-link p-1.5">
                            <lord-icon
                                src="https://cdn.lordicon.com/ahxaipjb.json"
                                trigger="hover"
                                style="width:24px;height:24px">
                            </lord-icon>
                            </a>
                            <div x-show="{{ user.has_notifications|lower }}" class="absolute top-0.5 right-0.5 w-2 h-2 bg-red-500 rounded-full"></div>
                            <div x-show="open" @click.outside="open = false" class="absolute origin-top top-15 right-0 w-60 sm:w-80 bg-white border border-neutral-200 rounded-xl shadow-md"
                                x-transition:enter="ease-out duration-200"
                                x-transition:enter-start="scale-y-50 opacity-0"
                                x-transition:enter-end="scale-y-100 opacity-100"
                                x-cloak>
                                <div class="p-2">
                                    <p class="font-semibold p-3">Notifications</p>
                                    <div class="flex flex-col gap-6 p-3 border-t border-neutral-200">
                                        {% for n in user.notification_list %}
                                            <div class="relative" x-data="{ notification: {{ n }} }">
                                                <div class="flex items-center"
                                                    :class="{ 'text-green-500' : notification.type=='success', 'text-blue-500' : notification.type=='info', 'text-orange-400' : notification.type=='warning', 'text-red-500' : notification.type=='error', 'text-gray-800' : notification.type=='default' }">
                                                    
                                                    <svg x-show="notification.type=='success'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM16.7744 9.63269C17.1238 9.20501 17.0604 8.57503 16.6327 8.22559C16.2051 7.87615 15.5751 7.93957 15.2256 8.36725L10.6321 13.9892L8.65936 12.2524C8.24484 11.8874 7.61295 11.9276 7.248 12.3421C6.88304 12.7566 6.92322 13.3885 7.33774 13.7535L9.31046 15.4903C10.1612 16.2393 11.4637 16.1324 12.1808 15.2547L16.7744 9.63269Z" fill="currentColor"></path></svg>
                                                    <svg x-show="notification.type=='info'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9ZM13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12V16C11 16.5523 11.4477 17 12 17C12.5523 17 13 16.5523 13 16V12Z" fill="currentColor"></path></svg>
                                                    <svg x-show="notification.type=='warning'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.44829 4.46472C10.5836 2.51208 13.4105 2.51168 14.5464 4.46401L21.5988 16.5855C22.7423 18.5509 21.3145 21 19.05 21L4.94967 21C2.68547 21 1.25762 18.5516 2.4004 16.5862L9.44829 4.46472ZM11.9995 8C12.5518 8 12.9995 8.44772 12.9995 9V13C12.9995 13.5523 12.5518 14 11.9995 14C11.4473 14 10.9995 13.5523 10.9995 13V9C10.9995 8.44772 11.4473 8 11.9995 8ZM12.0009 15.99C11.4486 15.9892 11.0003 16.4363 10.9995 16.9886L10.9995 16.9986C10.9987 17.5509 11.4458 17.9992 11.9981 18C12.5504 18.0008 12.9987 17.5537 12.9995 17.0014L12.9995 16.9914C13.0003 16.4391 12.5532 15.9908 12.0009 15.99Z" fill="currentColor"></path></svg>
                                                    <svg x-show="notification.type=='error'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM11.9996 7C12.5519 7 12.9996 7.44772 12.9996 8V12C12.9996 12.5523 12.5519 13 11.9996 13C11.4474 13 10.9996 12.5523 10.9996 12V8C10.9996 7.44772 11.4474 7 11.9996 7ZM12.001 14.99C11.4488 14.9892 11.0004 15.4363 10.9997 15.9886L10.9996 15.9986C10.9989 16.5509 11.446 16.9992 11.9982 17C12.5505 17.0008 12.9989 16.5537 12.9996 16.0014L12.9996 15.9914C13.0004 15.4391 12.5533 14.9908 12.001 14.99Z" fill="currentColor"></path></svg>
                                                    <p class="font-medium leading-none text-gray-800" x-text="notification.message"></p>
                                                </div>
                                                <p x-show="notification.description" 
                                                    :class="{ 'pl-5' : notification.type!='default' }"
                                                    class="mt-1.5 text-sm leading-none opacity-70" x-html="notification.description"></p>
                                            </div>

                                        {% empty %}
                                            <p class="text-sm text-neutral-600 py-4">No notifications</p>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </li>


                    </ul>
                </nav>
                <div x-data="{ open: false }" class="relative">
                    <div @click="open = !open;" class="w-9 h-9 border border-neutral-300 rounded-full overflow-hidden">
                        <img src="https://placehold.co/36/e0e0e0/b0b0b0?text={{ user.first_name|slice:':1'|upper }}" alt="">
                    </div>
                    <div x-show="open" @click.outside="open = false"
                            x-transition:enter="ease-out duration-200"
                            x-transition:enter-start="scale-y-50 opacity-0"
                            x-transition:enter-end="scale-y-100 opacity-100"

                    class="absolute origin-top right-0 mt-6 w-60 lg:w-72 bg-white border border-neutral-200 rounded-xl shadow-lg overflow-hidden z-10 flex flex-col gap-2 p-2" style="display: none;">
                        <div class="py-3 px-4">
                            <p class="font-semibold">{{ user.first_name }} </p>
                            <p class="text-sm text-neutral-600">{{ user.email }}</p>
                            <div class="mt-2 flex items-center gap-2 font-medium">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap-icon lucide-zap"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>
                                {% if user.credits_left == 0 %}
                                <p class="text-red-600 text-sm">No Credits available</p>
                                {% elif user.credits_left < 10 %}
                                <p class="text-red-600 text-sm">Only {{ user.credits_left }} Cradits left</p>
                                {% else %}
                                <p class="text-black text-sm">{{ user.credits_left }} Cradits left</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="border-t border-neutral-200"></div>
                        <a href="{% url "buy_credits" %}" class="btn-link">
                            <lord-icon
                                src="https://cdn.lordicon.com/apgkpdeb.json"
                                trigger="hover"
                                style="width:20px;height:20px">
                            </lord-icon>
                            Buy Cradits</a>
                        <a href="#" class="btn-link">
                            <lord-icon
                                src="https://cdn.lordicon.com/bushiqea.json"
                                trigger="hover"
                                style="width:20px;height:20px">
                            </lord-icon>
                            Profile</a>
                        <a href="#" class="btn-link">
                            <lord-icon
                                src="https://cdn.lordicon.com/asyunleq.json"
                                trigger="hover"
                                style="width:20px;height:20px">
                            </lord-icon>
                            Settings</a>
                        <a href="{% url 'logout' %}" class="btn-link text-red-600">

                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out-icon lucide-log-out"><path d="m16 17 5-5-5-5"/><path d="M21 12H9"/><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/></svg>
                            Logout</a>
                    </div>
                </div>
            </div>


        </div>
    </header>

    <div class="flex-1 flex transition-all">
        <div x-show="sidebar" @click="sidebar = false" class="lg:hidden absolute z-1 inset-0 bg-white/50 backdrop-blur-xs" x-transition style="display: none;"></div>
        <aside x-show="sidebar"
            class="origin-left absolute pt-14 lg:pt-4 lg:static inset-y-0 left-0 overflow-hidden bg-white border-r border-neutral-200 w-60 h-full z-2 transition-transform duration-300 ease-in-out"
            x-transition:enter="ease-out duration-200"
            x-transition:enter-start="scale-x-0"
            x-transition:enter-end="scale-x-100"
            x-transition:leave="ease-in duration-200"
            x-transition:leave-start="scale-x-100"
            x-transition:leave-end="scale-x-0"
            x-cloak>
            <div class="p-4">
                <div class="flex flex-col gap-4">
                    <a href="/dashboard/" class="btn-link  {% if request.path == '/dashboard/' %} bg-neutral-100 {% endif %}">
                        <lord-icon
                            src="https://cdn.lordicon.com/oeotfwsx.json"
                            trigger="hover"
                            style="width:20px;height:20px">
                        </lord-icon>
                        Home
                    </a>
                    <a href="/templates/" class="btn-link  {% if request.path == '/templates/' %} bg-neutral-100 {% endif %}">
                        <lord-icon
                            src="https://cdn.lordicon.com/dutqakce.json"
                            trigger="hover"
                            style="width:20px;height:20px">
                        </lord-icon>
                        Templates
                    </a>
                    <a href="{% url "buy_credits" %}" class="btn-link {% if request.path == '/buy_credits/' %}  bg-neutral-100 {% endif %}">
                            <lord-icon
                                src="https://cdn.lordicon.com/apgkpdeb.json"
                                trigger="hover"
                                style="width:20px;height:20px">
                            </lord-icon>
                            Buy Cradits</a>
                    <a href="/settings/" class="btn-link {% if request.path == '/settings/' %} bg-neutral-100 {% endif %}">
                        <lord-icon
                            src="https://cdn.lordicon.com/asyunleq.json"
                            trigger="hover"
                            style="width:20px;height:20px">
                        </lord-icon>
                        Settings
                    </a>
                    <hr>
                    <a href="/about/" class="btn-link {% if request.path == '/acout/' %} bg-neutral-100 {% endif %}">
                        <lord-icon
                            src="https://cdn.lordicon.com/yhtmwrae.json"
                            trigger="hover"
                            style="width:20px;height:20px">
                        </lord-icon>
                        About Us
                    </a>
                    <a href="/contact/" class="btn-link {% if request.path == '/contact/' %} bg-neutral-100 {% endif %}">
                        <lord-icon
                            src="https://cdn.lordicon.com/wtywrnoz.json"
                            trigger="hover"
                            style="width:20px;height:20px">
                        </lord-icon>
                        Contact
                    </a>
                    <a href="/help/" class="btn-link {% if request.path == '/help/' %} bg-neutral-100 {% endif %}">
                        <lord-icon
                            src="https://cdn.lordicon.com/biqqsrac.json"
                            trigger="hover"
                            style="width:20px;height:20px">
                        </lord-icon>
                        Get Help
                    </a>
                </div>
            </div>
            
        </aside>
        

        <section class="flex-1 flex flex-col justify-between overflow-y-auto ml-60 h-[calc(100vh-64px)] bg-neutral-50" x-init="$el.classList.remove('ml-60')">
            {% block content %}
                <div class="p-6 md:p-10 max-w-4xl">

                    <div class="flex flex-col gap-6 mb-8">
                        <div class="flex items-center justify-between">
                            <h2 class="h2">Pages</h2>
                            <a href="{% url "add_page" %}" class="btn text-sm py-1.5 px-3 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-icon lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                Add Page
                            </a>
                        </div>
                        
                        <ul class="flex flex-col gap-2">
                            {% for page in pages %}
                                <hr class="my-1">
                                <li class="flex items-center justify-between gap-4">
                                    <a href="{% url "page" page.id %}" class="btn-link p-3">
                                        <img class="w-7 h-7 rounded-full" src="{{ page.picture }}" alt="">
                                        {{ page.page_name }}
                                    </a>
                                    <div class="flex items-center gap-2 sm:gap-4">
                                        <form action="{% url "page_toggle" page.id %}" method="POST">
                                            {% csrf_token %}
                                            <div x-data="{ switchOn: {% if page.enabled %} true {% else %} false {% endif %} }" class="flex items-center justify-center space-x-3">
                                                <input id="thisId" type="checkbox" name="switch" class="hidden" :checked="switchOn">

                                                <button 
                                                    x-ref="switchButton"
                                                    type="submit" 
                                                    @click="switchOn = ! switchOn"
                                                    :class="switchOn ? 'bg-neutral-900' : 'bg-neutral-200'" 
                                                    class="relative inline-flex h-4 py-[3px] ml-4 rounded-full focus:outline-none w-7"
                                                    x-cloak>
                                                    <span :class="switchOn ? 'translate-x-[15px]' : 'translate-x-[3px]'" class="w-[10px] h-[10px] duration-200 ease-in-out bg-white rounded-full"></span>
                                                </button>

                                                <label @click="$refs.switchButton.click(); $refs.switchButton.focus()" :id="$id('switch')" 
                                                    :class="{ 'text-neutral-900': switchOn, 'text-gray-400': ! switchOn }"
                                                    class="hidden sm:block text-xs font-medium select-none"
                                                    x-cloak>
                                                    {% if page.enabled %}
                                                        Active
                                                    {% else %}
                                                        Paused
                                                    {% endif %}
                                                </label>
                                            </div>
                                        </form>
                                        <a href="{% url "page" page.id %}#settings" class="btn-link p-2">
                                            <lord-icon
                                                src="https://cdn.lordicon.com/asyunleq.json"
                                                trigger="hover"
                                                style="width:20px;height:20px">
                                            </lord-icon>
                                        </a>
                                    </div>
                                </li>
                            {% empty %}
                                <div class="py-12 flex flex-col items-center justify-center gap-4">
                                    <svg class="stroke-neutral-500" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-open-icon lucide-package-open"><path d="M12 22v-9"/><path d="M15.17 2.21a1.67 1.67 0 0 1 1.63 0L21 4.57a1.93 1.93 0 0 1 0 3.36L8.82 14.79a1.655 1.655 0 0 1-1.64 0L3 12.43a1.93 1.93 0 0 1 0-3.36z"/><path d="M20 13v3.87a2.06 2.06 0 0 1-1.11 1.83l-6 3.08a1.93 1.93 0 0 1-1.78 0l-6-3.08A2.06 2.06 0 0 1 4 16.87V13"/><path d="M21 12.43a1.93 1.93 0 0 0 0-3.36L8.83 2.2a1.64 1.64 0 0 0-1.63 0L3 4.57a1.93 1.93 0 0 0 0 3.36l12.18 6.86a1.636 1.636 0 0 0 1.63 0z"/></svg>
                                    <p class="text-neutral-500">No pages connected</p>
                                </div>
                            {% endfor %}
                        </ul>
                    </div>

                </div>
            {% endblock content %}
            <div class="flex items-center justify-between gap-4 py-2 px-4 border-t border-neutral-200">
                <div class="flex items-center justify-center gap-2">
                    <p class="text-neutral-500 text-xs">Powered by</p>
                    <img src="https://www.gstatic.com/lamda/images/gemini_sparkle_aurora_33f86dc0c0257da337c63.svg" alt="Gemini logo" class="h-4">
                    <p class="text-neutral-800 text-sm">Gemini</p></p>
                </div>
                <div class="flex items-center divide divide-neutral-200 text-xs *:px-1 *:sm:px-2">
                    <a href="privacy/" class="link">Privacy <span class="hidden sm:inline">Policy</span></a>|
                    <a href="terms/" class="link">Terms <span class="hidden sm:inline">of Service</span></a>|
                    <a href="refund/" class="link">Refund <span class="hidden sm:inline">Policy</span></a>
                </div>
            </div>
        </section>
        
    </div>
</div>
{% endblock body %}

    {% block scripts %}
    <script src="{% static 'js/main.js' %}"></script>

    {% endblock scripts %}